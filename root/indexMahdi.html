<!DOCTYPE html> <meta charset="utf-8" />
<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <!--
    I recommend you host this file on your own, since this will change without warning
  -->
  <script src="http://datamaps.github.io/scripts/datamaps.world.min.js?v=1"></script>
  <h2>Datamaps Playground</h2>
  <p><a href="http://datamaps.github.io/">DataMaps Project Homepage</a></p>
  <div
    id="container1"
    style="position: relative; width: 80%; max-height: 450px;"
  ></div>

  <script>
    var width = 960,
      height = 500;
    var centered = null;

    function calcCentroid(coordinates) {
      const sum = (accumulator, currentValue) => accumulator + currentValue;
      const n = bounds.length;
      var bounds = coordinates[0],
        x = bounds.map(u => u[0]).reduce(sum) / n,
        y = bounds.map(u => u[1]).reduce(sum) / n;
      return [x, y];
    }

    function zoomToCountry(map, geography) {
      map.bubbles([]);
      if (centered == geography) {
        map.svg
          .selectAll(".datamaps-subunits")
          .transition()
          .duration(750)
          .style("stroke-width", "1.5px")
          .attr("transform", "");
        centered = null;
        return;
      }
      centered = geography;
      var path = d3.geo.path().projection(map.projection);
      var bounds = path.bounds(centered),
        dx = bounds[1][0] - bounds[0][0],
        dy = bounds[1][1] - bounds[0][1],
        x = (bounds[0][0] + bounds[1][0]) / 2,
        y = (bounds[0][1] + bounds[1][1]) / 2,
        scale = 0.9 / Math.max(dx / width, dy / height),
        translate = [width / 2 - scale * x, height / 2 - scale * y];

      map.svg
        .selectAll("g")
        .transition()
        .duration(750)
        .style("stroke-width", 1.5 / scale + "px")
        .attr("transform", "translate(" + translate + ")scale(" + scale + ")");
      map.bubbles(bubbles);
    }

    var map = new Datamap({
      scope: "world",
      responsive: true,

      element: document.getElementById("container1"),

      projection: "mercator",

      height: 500,

      fills: {
        defaultFill: "#f0af0a",

        lt50: "rgba(0,244,244,0.9)",

        gt50: "red"
      },

      done: function(datamap) {
        datamap.svg
          .selectAll(".datamaps-subunit")
          .on("click", function(geography) {
            zoomToCountry(datamap, geography);
          });
      },

      data: {
        USA: { fillKey: "lt50" },

        RUS: { fillKey: "lt50" },

        CAN: { fillKey: "lt50" },

        BRA: { fillKey: "gt50" },

        ARG: { fillKey: "gt50" },

        COL: { fillKey: "gt50" },

        AUS: { fillKey: "gt50" },

        ZAF: { fillKey: "gt50" },

        MAD: { fillKey: "gt50" },

        FRA: { fillKey: "gt50" }
      }
    });

    //bubbles, custom popup on hover template
    var bubbles = [
      {
        name: "Hot",

        latitude: 21.32,

        longitude: 5.32,

        radius: 2,

        fillKey: "gt50"
      },

      {
        name: "Chilly",

        latitude: -25.32,

        longitude: 120.32,

        radius: 18,

        fillKey: "lt50"
      },

      {
        name: "Hot again",

        latitude: 21.32,

        longitude: -84.32,

        radius: 8,

        fillKey: "gt50"
      }
    ];
    /*
    map.bubbles(bubbles, {
      popupTemplate: function(geo, data) {
        return "<div class='hoverinfo'>It is " + data.name + "</div>";
      }
    });
*/
  </script>
</body>
