<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<title>FishEye TD</title>
<style>
* {padding:0;margin:0}
</style>
</head>
<body>
<h1>attentat carte avec des points</h1>
<div id="container">
	<div id="chart"></div>
</div>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script>
const m0 = {
  id: "9fc7a290cf64994b@261",
  variables: [
    {
      inputs: ["md"],
      value: (function(md){return(
md`# Walmart’s Growth

This animation shows the expansion of Walmart over the last fifty years. On July 2, 1962 in [Rogers, Arkansas](https://en.wikipedia.org/wiki/Rogers,_Arkansas), the first Walton’s <svg width=8 height=16><circle cx=4 cy=10 r=4 fill=blue></circle></svg> opened. [This dataset](http://users.econ.umn.edu/~holmes/data/WalMart/index.html) from 2006 includes about 3,100 Walmart locations <svg width=8 height=16><circle cx=4 cy=10 r=3.5 fill=none stroke=black></circle></svg> in the continguous United States.`
)})
    },
    {
      name: "viewof replay",
      inputs: ["html"],
      value: (function(html){return(
html`<button>Replay`
)})
    },
    {
      name: "replay",
      inputs: ["Generators","viewof replay"],
      value: (G, _) => G.input(_)
    },
    {
      name: "initial date",
      value: (function(){return(
null
)})
    },
    {
      name: "mutable date",
      inputs: ["Mutable","initial date"],
      value: (M, _) => new M(_)
    },
    {
      name: "date",
      inputs: ["mutable date"],
      value: _ => _.generator
    },
    {
      name: "chart",
      inputs: ["replay","d3","data","DOM","topojson","us","mutable date"],
      value: (function(replay,d3,data,DOM,topojson,us,$0)
{
  replay;

  const width = 960;
  const height = 600;
  const path = d3.geoPath();

  const delay = d3.scaleTime()
      .domain([data[0].date, data[data.length - 1].date])
      .range([0, 20000]);

  const svg = d3.select(DOM.svg(width, height))
      .style("width", "100%")
      .style("height", "auto");

  svg.append("path")
      .datum(topojson.merge(us, us.objects.lower48.geometries))
      .attr("fill", "#ddd")
      .attr("d", path);

  svg.append("path")
      .datum(topojson.mesh(us, us.objects.lower48, (a, b) => a !== b))
      .attr("fill", "none")
      .attr("stroke", "white")
      .attr("stroke-linejoin", "round")
      .attr("d", path);

  const g = svg.append("g")
      .attr("fill", "red")
      .attr("stroke", "black");

  svg.append("circle")
      .attr("fill", "blue")
      .attr("transform", `translate(${data[0]})`)
      .attr("r", 3);

  for (const d of data) {
    d3.timeout(() => {
      g.append("circle")
          .attr("transform", `translate(${d})`)
          .attr("r", 3)
          .attr("fill-opacity", 1)
          .attr("stroke-opacity", 0)
        .transition()
          .attr("fill-opacity", 0)
          .attr("stroke-opacity", 1);
    }, delay(d.date));
  }

  svg.transition()
      .ease(d3.easeLinear)
      .duration(delay.range()[1])
      .tween("date", () => {
        const i = d3.interpolateDate(...delay.domain());
        return t => $0.value = d3.timeDay(i(t));
      });

  return svg.node();
}
)
    },
    {
      name: "data",
      inputs: ["d3"],
      value: (async function(d3)
{
  const parseDate = d3.timeParse("%m/%d/%Y");
  const projection = d3.geoAlbersUsa().scale(1280).translate([480, 300]);
  const data = await d3.tsv("https://gist.githubusercontent.com/mbostock/4330486/raw/fe47cd0f43281cae3283a5b397f8f0118262bf55/walmart.tsv", d => {
    const p = projection(d);
    p.date = parseDate(d.date);
    return p;
  });
  data.sort((a, b) => a.date - b.date);
  return data;
}
)
    },
    {
      name: "us",
      inputs: ["d3"],
      value: (async function(d3)
{
  const us = await d3.json("https://unpkg.com/us-atlas@1/us/10m.json");
  us.objects.lower48 = {
    type: "GeometryCollection",
    geometries: us.objects.states.geometries.filter(d => d.id !== "02" && d.id !== "15")
  };
  return us;
}
)
    },
    {
      name: "topojson",
      inputs: ["require"],
      value: (function(require){return(
require("topojson-client@3")
)})
    },
    {
      name: "d3",
      inputs: ["require"],
      value: (function(require){return(
require("d3@5")
)})
    }
  ]
};

const notebook = {
  id: "9fc7a290cf64994b@261",
  modules: [m0]
};


</script>
</body>
</html>